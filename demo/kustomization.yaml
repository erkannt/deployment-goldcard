apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - "../base"

commonLabels:
  app.kubernetes.io/name: sciety
  app.kubernetes.io/instance: sciety--demo

namePrefix:
  sciety--demo--

patches:
  - patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: sciety-demo.elifesciences.org
      - op: replace
        path: /spec/tls/0/hosts/0
        value: sciety-demo.elifesciences.org
      - op: replace
        path: /spec/tls/0/hosts/1
        value: www.sciety-demo.elifesciences.org
    target:
      kind: Ingress
      name: frontend

configMapGenerator:
  - name: frontend-env
    literals:
      - ALLOW_SITE_CRAWLERS=false
      - APP_ORIGIN=https://sciety-demo.elifesciences.org
      - APP_CACHE=redis
      - CACHE_HOST=sciety--demo--cache
      - EXPERIMENT_ENABLED=
      - FATHOM_SITE_ID=
      - GOOGLE_TAG_MANAGER_ID=
  - name: ingestion-env
    literals:
      - INGESTION_TARGET_APP=https://sciety-demo.elifesciences.org
      - EXPERIMENT_ENABLED=""

secretGenerator:
  - name: frontend-secret
    envs:
      - "./frontend-secret.env"
  - name: ingestion-secret
    envs:
      - "./ingestion-secret.env"
